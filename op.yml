name: github.com/opspec-pkgs/golang.build.bin
description: builds a binary from golang src code
inputs:
  srcDir:
    dir:
      description: directory containing the packages source code; external deps must be vendored
      default: .
  baseImport:
    string:
      constraints: { minLength: 1 }
      description: base import path of the package; usually 'git.host/org/repo'
  import:
    string:
      description: import path of the package (may be same as baseImport or descendant)
  goVersion:
    string:
      description: version of go to build
      default: '1.13'
  GOOS:
    string:
      description: OS to compile bin against; see https://golang.org/doc/install/source#environment for supported values
      default: linux
  GOARCH:
    string:
      description: Arch to compile bin against; see https://golang.org/doc/install/source#environment for supported values
      default: amd64
  GOFLAGS:
    string:
      description: FLAGS to compile bin with; see https://golang.org/doc/install/source#environment for supported values
  CGO_ENABLED:
    number:
      constraints: { enum: [0, 1] }
      description: whether to allow dynamic c lib imports; see https://golang.org/doc/install/source#ccompiler
      default: 0
outputs:
  bin:
    file:
      description: the built bin
version: 1.2.0
run:
  container:
    cmd: [ /cmd.sh ]
    dirs:
      /src: $(srcDir)
    envVars:
      baseImport:
      CGO_ENABLED:
      import:
      GOOS:
      GOARCH:
      GOFLAGS:
    files:
      /cmd.sh:
      /pkgBin: $(bin)
    image: { ref: 'golang:$(goVersion)' }
    workDir: /
